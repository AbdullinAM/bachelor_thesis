%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{ТЕСТИРОВАНИЕ ПРОТОТИПА И АНАЛИЗ ПОЛУЧЕННЫХ РЕЗУЛЬТАТОВ}
\label{chapter:testing}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
В данном разделе проводится исследование показателей разработанной технологии путем анализа результатов запуска прототипа на нескольких реальных программных проектах. Исследованию подвергается количество извлекаемых контрактов и их качество. Под качеством понимается то, что извлеченные контракты соответствуют функции, то есть описывают поведение функции с какой-то интересной для пользователя точки зрения. Количество извлекаемых контрактов измеряется автоматически. Качество проверяется вручную на подвыборке извлеченных контрактов.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Описание тестовых проектов}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Для тестирования прототипа было выбрано несколько проектов с открытым исходным кодом:
\begin{itemize}
\item библиотека beanstalkd --- простая и высокопроизводительная очередь, разработанная для уменьшения времени отклика при обращении к веб-сервисам большого объема путем асинхронного запуска сложных задач;
\item библиотека iputils --- набор небольших утилит для работы с сетью в Lunix;
\item sslsplit --- инструмент для создания атак <<человек посередине>>(Man in the middle, MITM) в сети с SSL/TSL шифрованием (предназначен для проверки безопасности приложений и уязвимости сети);
\item git --- распределенная СКВ;
%\item vim ---  многофункциональный свободный текстовый редактор с полной свободой настройки и автоматизации, обладающий большим количеством расширений и надстроек.
\end{itemize}

Данные проекты достаточно сильно отличаются друг от друга как по объему, так и по структуре. Проект beanstalkd является достаточно маленьким ($SLOC \approx 7.5k$), весь код является сильносвязным, его нельзя разбить на отдельные модули. Проект iputils также является маленьким ($SLOC \approx 12k$), однако он состоит из 11 еще более маленьких подпроектов.

SslSplit является проектом среднего размера ($SLOC \approx 100k$), в проекте отсутствует декомпозиция. Он в один исполняемый файл.

Git является большим программным проектом ($SLOC \approx 340k$). Проект содержит в себе несколько подсистем, одна из которых является большой, а остальные сравнительно маленькими.
%Проекты vim и git представляют из себя большие программные проекты ($SLOC \approx 330k$ в каждом). Git содержит в себе несколько подсистем, одна из которых является большой, а остальные сравнительно маленькими. Vim является сильносвязным и компилируется в один объемный исполняемый файл.

\begin{table}
	\caption{Тестовый набор проектов}
	\begin{center}
	\begin{tabular}{|l|l|l|}
	\hline 
	\textbf{Проект} & \textbf{SLOC} & \textbf{Модульность}	\\ 
	\hline 
	beanstalkd & $7.5k$ & отсутствует \\ 
	\hline 
	iputils & $12k$ & явно выраженная \\ 
	\hline 
	sslsplit & $100k$  & отсутствует \\ 
	\hline 
	git & $340k$ & небольшая \\ 
	\hline 
	\end{tabular} 
	\end{center}
	\label{table:testProjects}
\end{table}

Характеристики тестовых проектов сведены в таблицу \ref{table:testProjects}. Данный тестовый набор позволит проверить эффективность разработанной технологии как для малых, так и для больших проектов с разной степенью функциональной декомпозиции.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Схема работы прототипа}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Общая схема работы прототипа в тестовом режиме выглядит следующим образом:
\begin{itemize}
\item для целевого проекта из СКВ получается его последняя версия;
\item в файле конфигурации проекта в качестве используемого компилятора указывается Borealis;
\item производится сборка проекта;
\item производится анализ результатов работы прототипа.
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Конфигурация прототипа для выполнения тестирования}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Для проверки работы прототипа на выбранном тестовом наборе изначально была собрана объемная база данных предикатов. Сбор базы производился на случайной выборке 40 проектов различного объема и сложности. Выборка производилась вручную.

Для проведения анализа проектов необходимо выбрать значения констант $X$ и $K$, которые определяют параметры алгоритма (см. раздел \ref{section:merging}). В данной работе главной целью является точность результатов анализа, но полнота также важна. Поэтому, было принято решение выбрать значения этих коэффициентов с небольшим смещением в сторону точности: $K=0.68$, $X=3$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Результаты тестирования}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Результаты анализа тестовых проектов приведены в таблице \ref{table:testing}. Из полученных контрактов была получена случайная выборка контрактов, которая была проверена на качество. Проверка показала, что получаемые в результате анализа предусловия являются качественными.

\begin{table}
	\caption{Результаты тестирования}
	\begin{center}
	\begin{tabular}{|l|l|l|}
	\hline 
	\textbf{Проект} & \textbf{Кол-во предусловий}	\\ 
	\hline 
	beanstalkd & 10 \\ 
	\hline 
	iputils & 15  \\ 
	\hline 
	sslsplit & 65 \\
	\hline 
	git & 186 \\ 
	\hline 
	\end{tabular} 
	\end{center}
	\label{table:testing}
\end{table}

Примеры извлеченных предикатов приведены на листинге \ref{listings:extractionExample}. Проверим полученные контракты на качество. Для функции \texttt{int probe_ttl(int fd, struct addrinfo *ai, int ttl)}, объявленной в проекте iputils, было получено, что первый аргумент должен быть неотрицательным. Данная функция выполняет обмен по сети и в качестве первого аргумента принимает номер сокета. Значит, полученный контракт является правильным, так как номер сокета не может быть отрицательным.

В нескольких проектах был обнаружен контракт для функции \texttt{int bind(int sockfd, const struct sockaddr *addr, socklen_t addrlen)}, который говорит о том, что первый аргумент функции не должен быть равен -1 (в системе LLVM нет знаковых чисел, есть только знаковые операции, поэтому число -1 представляется в дополнительном коде как 4294967295). Так как первым аргументом в функцию передается номер сокета, он должен быть неотрицательным. Поэтому, извлеченный контракт является качественным.

В проекте git был получен контракт для функции \texttt{static void work_done(struct work_item *w)}, который указывает на то, что передаваемый аргумент не должен указывать на ноль. Передаваемый указатель не проверяется на валидность перед его использованием, поэтому полученный контракт является корректным.
\lstinputlisting[
label={listings:extractionExample},
caption={Примеры извлеченных контрактов},
]
{src/extractionExample}

По результатам тестирования можно сделать вывод о том, что разработанный прототип показал свою работоспособность. На тестовом наборе проектов было извлечено большое количество предусловий. Анализ этих предусловий показал, что извлеченные контракты являются качественными.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Резюме}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
В данном разделе выполнено тестирование разработанного прототипа системы автоматического извлечения контрактов из исходного кода. Показана его работоспособность. Анализ результатов тестирования говорит о целесообразности применения предлагаемой в данной работе технологии автоматического извлечения контрактов из исходного кода.